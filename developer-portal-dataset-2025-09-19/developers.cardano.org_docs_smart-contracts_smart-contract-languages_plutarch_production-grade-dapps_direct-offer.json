{
  "url": "https://developers.cardano.org/docs/smart-contracts/smart-contract-languages/plutarch/production-grade-dapps/direct-offer",
  "content": "![Cardano Logo](/img/cardano-black.svg)\n![Cardano Logo](/img/cardano-white.svg)\n\n# Direct Offer\n\n## Introduction[​](#introduction \"Direct link to Introduction\")\n\nThe Direct Offer project provides a Plutarch-based implementation of a smart contract enabling peer-to-peer trading, in a trustless manner, for the Cardano blockchain. Without the need for a trusted third party or a Decentralized Exchange (DEX), a user can put up any Cardano native asset(s) for sale in exchange for any user-specified native asset(s).\n\nThe source code for these dApps can be found [here](https://github.com/Anastasia-Labs/direct-offer).\n\n## Documentation[​](#documentation \"Direct link to Documentation\")\n\n### What is Peer-to-Peer (P2P) trading?[​](#what-is-peer-to-peer-p2p-trading \"Direct link to What is Peer-to-Peer (P2P) trading?\")\n\nP2P trading in the context of this project refers to the direct buying and selling of Cardano Native Tokens (both Fungible & Non-Fungible Tokens) among users, without a third party or an intermediary. This is unlike buying and selling digital assets using a Centralized Exchange (CEX), where you cannot transact directly with counterparties or a DEX where you trade against a fixed Liquidity Pool.\n\nTrading on a CEX requires you to give custody of your tokens to them, so they can execute the trades you enter based on their charts and market order aggregators. A CEX provides access to their order book and facilitates trades and takes fees in exchange.\n\nDepending on the type of order you use, effects such as slippage may mean you don’t get the exact price you want. P2P trading, on the other hand, gives you full control over pricing, settlement time, and whom you choose to sell to and buy from. What is even better you don't need to give custody of your assets to a centralized entity, they are locked in a contract from which you can reclaim them up until the point they are bought.\n\n### How can this project facilitate P2P trading?[​](#how-can-this-project-facilitate-p2p-trading \"Direct link to How can this project facilitate P2P trading?\")\n\nThis project fulfills the cornerstone requirement of a trusted Escrow, over seeing the trade in the form of a smart contract. It locks the seller's assets in the contract until a buyer provides the required ask price or the seller wishes to cancel the offer and claim the funds back.\n\n### Details[​](#details \"Direct link to Details\")\n\n#### Basics of a single offer[​](#basics-of-a-single-offer \"Direct link to Basics of a single offer\")\n\nA seller sends the assets he wishes to exchange, to the contract, thus locking the funds therein. This UTxO contains a datum which specifies the \"creator\" of the offer and the assets wished in return, \"toBuy\" indicates the price.\n\n`data PDirectOfferDatum (s :: S)  \n = PDirectOfferDatum  \n ( Term  \n s  \n ( PDataRecord  \n '[ \"creator\" ':= PAddress  \n , \"toBuy\" ':= PValue 'Sorted 'Positive  \n ]  \n )  \n )`\n\nA buyer interested in the offered assets initiates a transaction (with a \"PExecuteOffer\" redeemer) spending the locked UTxO, along with sending the \"toBuy\" assets to the \"creator\". This condition is validated by the contract first before allowing the transaction to proceed further. However, if the seller decides to cancel the offer, he can do so by initiating a transaction (with a \"PReclaim\" redeemer) and claim all the locked assets back.\n\n`data PDirectOfferRedeemer (s :: S)  \n = PExecuteOffer (Term s (PDataRecord '[]))  \n | PReclaim (Term s (PDataRecord '[]))`\n\nOne UTxO at the smart contract address translates to one sell order.\n\n#### Multiple offer matching in a single transaction[​](#multiple-offer-matching-in-a-single-transaction \"Direct link to Multiple offer matching in a single transaction\")\n\nA single transaction can fulfill multiple sell orders by matching it with valid buy orders. Whether all the buy orders in the tx are correct or not is validated only once at the tx level using the [Zero ADA Withdrawal Trick](https://github.com/cardano-foundation/CIPs/pull/418#issuecomment-1366605115) from the Staking validator.\n\n`directOfferGlobalLogic :: Term s PStakeValidator`\n\nThis Staking validator's credential is used as a parameter to a Spending Validator (the smart contract which locks the seller UTxOs). Spending validator ensures that the Staking validator is executed in the tx. A successful validation from both spending and staking validator is essentail for the spending of seller UTxOs.\n\n`directOfferValidator :: Term s (PStakingCredential :--> PValidator)`\n\nFor carrying out this validation, the Staking Validator requires a redeemer containing one-to-one correlation between script input UTxOs (seller UTxOs) and buy output UTxOs (sent to seller from buyer). This is provided via ordered lists of input/output indices of inputs/ouputs present in the Script Context.\n\n`data PGlobalRedeemer (s :: S)  \n = PGlobalRedeemer  \n ( Term  \n s  \n ( PDataRecord  \n '[ \"inputIdxs\" ':= PBuiltinList (PAsData PInteger)  \n , \"outputIdxs\" ':= PBuiltinList (PAsData PInteger)  \n ]  \n )  \n )`\n\nFor e.g.\n\n`Inputs : [saleOfferA, saleOfferC, buyerInput3, saleOfferB, buyerInput1, buyerInput2]  \nOutputs : [buyOfferA, buyOfferB, buyOfferC, buyerOuput1, buyerOutput2, buyerOutput3]  \nInputIdxs : [0, 1, 3]  \nOutputIdxs : [0, 2, 1]`\n\nWhile its easy to understand and declare indices of outputs (the order in which outputs appear in the tx builder), we cannot control the order of inputs as seen by the script. As inputs are sorted lexicographically based on their output reference, first by Tx#Id and then by Tx#Idx.\n\nNote: Staking validator is not needed to be invoked if the seller wishes to cancel the offer and reclaim his funds.\n\n## Offchain Implementation[​](#offchain-implementation \"Direct link to Offchain Implementation\")\n\nYou can find the entire offchain implementation complimenting this dApp [here](https://github.com/Anastasia-Labs/direct-offer-offchain).",
  "images": [],
  "extraction_metadata": {
    "batch_number": 12,
    "extraction_timestamp": "2025-09-19T14:05:17.156321",
    "extraction_time": 1.6163160800933838,
    "source": "tavily_api_raw"
  }
}